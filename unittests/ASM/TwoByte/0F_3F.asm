%ifdef CONFIG
{
  "RegData": {
  },
  "MemoryRegions": {
    "0x100000000": "4096"
  }
}
%endif

; this just ensures the thunking system runs
; it doesn't actually load a lib

; create struct in ram
lea rdi, [rel libname]
lea rax, [rel init_struct]
mov [rax + 0], rdi
mov [rax + 8], rdi

; thunk
lea rdi, [rel init_struct]
lea rax, [rel thunk_test]
call rax

hlt

thunk_test:
db 0xf, 0x3f
db 0x27, 0x7e, 0xb7, 0x69, 0x5b, 0xe9, 0xab, 0x12, 0x6e, 0xf7, 0x85, 0x9d, 0x4b, 0xc9, 0xa2, 0x44, 0x46, 0xcf, 0xbd, 0xb5, 0x87, 0x43, 0xef, 0x28, 0xa2, 0x65, 0xba, 0xfc, 0x89, 0x0f, 0x77, 0x80

libname db 'not_a_real_lib', 0
db 0

align 8
init_struct dq 0, 0
